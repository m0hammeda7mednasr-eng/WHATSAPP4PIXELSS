# ๐งช ุงุฎุชุจุฑ ุงูุจูุชููุงุช ุงูุขู

## โ ุงูุชุญุฏูุซุงุช ุงููู ุงุชุนููุช

### 1. ุชุตููุญ Template Button Payload
- โ ุงูู `index` ุจูู ุฑูู ูุด string (`0` ุจุฏู `'0'`)
- โ ุงูู payload ุจูุชุจุนุช ุตุญ: `confirm_ORDER_ID` ู `cancel_ORDER_ID`

### 2. ุฅุถุงูุฉ ูุนุงูุฌุฉ ูู Button Type
- โ ุงููุธุงู ุฏูููุชู ุจูุชุนุงูู ูุน `button` (Template) ู `interactive` (ุนุงุฏู)
- โ ูู ููุน ููู ูุนุงูุฌุฉ ุฎุงุตุฉ ุจูู

---

## ๐ ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ

### ุงูุฎุทูุฉ 1: ุงุฑูุน ุงูุชุญุฏูุซุงุช ุนูู Vercel

```bash
# ูู Terminal
git add .
git commit -m "Fix template button handling"
git push origin main
```

ุงูุชุธุฑ Vercel ูุฎูุต ุงูู deployment (ุญูุงูู 1-2 ุฏูููุฉ).

---

### ุงูุฎุทูุฉ 2: ุชุฃูุฏ ูู ุงูุฅุนุฏุงุฏุงุช

#### ูู ุงููููุน โ Settings โ Template Settings:

**ูู ุนุงูุฒ ุชุณุชุฎุฏู Template ูู Meta:**
```
โ Use Template Message: ููุนูู
๐ Template Name: moon2 (ุฃู ุงุณู ุงูู template ุจุชุงุนู)
๐ Template Language: en (ุฃู ุงููุบุฉ ุงูููุงุณุจุฉ)
```

**ูู ุนุงูุฒ ุชุณุชุฎุฏู Interactive Message:**
```
โ Use Template Message: ูุนุทูู
```

ุงุถุบุท **ุญูุธ ุงูุฅุนุฏุงุฏุงุช**.

---

### ุงูุฎุทูุฉ 3: ุงุนูู ุทูุจ ุชุฌุฑูุจู

#### ูู Shopify:
1. ุงุนูู ุทูุจ ุฌุฏูุฏ
2. ุญุท ุฑูู ูุงุชุณุงุจ ุตุญูุญ
3. ุฃููู ุงูุทูุจ

#### ุฃู ุงุณุชุฎุฏู Test Script:
```bash
node test-shopify-order-confirmation.js
```

---

### ุงูุฎุทูุฉ 4: ุดูู ุงูุฑุณุงูุฉ ุนูู ุงููุงุชุณุงุจ

ูุชุณุชูู ุฑุณุงูุฉ ูููุง:
- โ ุชูุงุตูู ุงูุทูุจ
- โ ุฒุฑ "ุชุฃููุฏ ุงูุทูุจ โ"
- โ ุฒุฑ "ุฅูุบุงุก ุงูุทูุจ โ"

---

### ุงูุฎุทูุฉ 5: ุงุถุบุท ุนูู ุฒุฑ

#### ูู ุถุบุทุช "ุชุฃููุฏ":
1. โ ููุชุจุนุชูู ุฑุณุงูุฉ ุชุฃููุฏ
2. โ ุงูุทูุจ ููุชุนููู Fulfillment ูู Shopify
3. โ ููุชุถุงู Tag "whatsapp-confirmed"
4. โ ุงูู Status ูู Database ููุชุญุฏุซ

#### ูู ุถุบุทุช "ุฅูุบุงุก":
1. โ ููุชุจุนุชูู ุฑุณุงูุฉ ุฅูุบุงุก
2. โ ููุชุถุงู Tag "whatsapp-cancelled" ุจุณ
3. โ ุงูุทูุจ ูุด ููุชูุบู ูู Shopify
4. โ ุงูู Status ูู Database ููุชุญุฏุซ

---

## ๐ ุชุชุจุน ุงููุดููุฉ (ูู ุญุตูุช)

### 1. ุดูู Vercel Logs

1. ุงุฏุฎู ุนูู Vercel Dashboard
2. ุงุฎุชุงุฑ ุงููุดุฑูุน
3. ุงุถุบุท ุนูู **Functions**
4. ุฏูุฑ ุนูู `/api/webhook/whatsapp`
5. ุดูู ุงูู Logs

**ูู Template ุดุบุงู ุตุญุ ูุชูุงูู:**
```
๐ Template Button clicked: confirm_1234567890
โ Template button handled: { success: true, ... }
```

**ูู Interactive ุดุบุงู ุตุญุ ูุชูุงูู:**
```
๐ Interactive Button clicked: confirm_1234567890
โ Button handled: { success: true, ... }
```

---

### 2. ุดูู Database

ูู Supabase โ Table Editor โ `shopify_orders`:

```sql
SELECT 
  shopify_order_number,
  confirmation_status,
  order_status,
  confirmed_at,
  cancelled_at
FROM shopify_orders
ORDER BY created_at DESC
LIMIT 5;
```

**ูู ุชุฃููุฏ ุดุบุงู:**
- `confirmation_status` = `'confirmed'`
- `order_status` = `'fulfilled'`
- `confirmed_at` = ููุช ุงูุชุฃููุฏ

**ูู ุฅูุบุงุก ุดุบุงู:**
- `confirmation_status` = `'cancelled'`
- `order_status` = `'cancelled'`
- `cancelled_at` = ููุช ุงูุฅูุบุงุก

---

### 3. ุดูู Shopify

ูู Shopify Admin โ Orders:

**ูู ุชุฃููุฏ ุดุบุงู:**
- โ Order Status = `Fulfilled`
- โ Tags = `whatsapp-confirmed`
- โ Fulfillment created

**ูู ุฅูุบุงุก ุดุบุงู:**
- โ Order Status = ูุณู ุฒู ูุง ูู (ูุด Cancelled)
- โ Tags = `whatsapp-cancelled`
- โ ูููุด Fulfillment

---

## ๐ ุงููุดุงูู ุงูุดุงุฆุนุฉ ูุงูุญููู

### ุงููุดููุฉ 1: ุงูุจูุชููุงุช ูุด ุธุงูุฑุฉ
**ุงูุญู:**
- ุชุฃูุฏ ุฅู ุงูู Template ูุนุชูุฏ ูู Meta
- ุชุฃูุฏ ุฅู ุงุณู ุงูู Template ุตุญูุญ
- ุชุฃูุฏ ุฅู ุงููุบุฉ ูุทุงุจูุฉ

### ุงููุดููุฉ 2: ุงูุจูุชููุงุช ุธุงูุฑุฉ ุจุณ ูุด ุดุบุงูุฉ
**ุงูุญู:**
- ุดูู Vercel Logs
- ุชุฃูุฏ ุฅู ุงูู Webhook URL ุตุญูุญ ูู Meta
- ุชุฃูุฏ ุฅู ุงูู phone_number_id ููุฌูุฏ ูู brands table

### ุงููุดููุฉ 3: ุฑุณุงูุฉ ุงูุชุฃููุฏ ูุด ุจุชุชุจุนุช
**ุงูุญู:**
- ุชุฃูุฏ ุฅู ุงูู WhatsApp Token ุตุญูุญ
- ุชุฃูุฏ ุฅู ุงูุฑุณุงุฆู ุงููุฎุตุตุฉ ููุฌูุฏุฉ ูู Settings
- ุดูู Vercel Logs ููุฃุฎุทุงุก

### ุงููุดููุฉ 4: Fulfillment ูุด ุจูุชุนูู
**ุงูุญู:**
- ุชุฃูุฏ ุฅู Shopify Access Token ุตุญูุญ
- ุชุฃูุฏ ุฅู ุงูู Order ููุฌูุฏ ูู Shopify
- ุชุฃูุฏ ุฅู ุงูู Order ูุด Fulfilled ูุจู ูุฏู

---

## ๐ ุงููุฑู ุจูู Template ู Interactive

| ุงูููุฒุฉ | Template | Interactive |
|--------|----------|-------------|
| **ููุน ุงูู Webhook** | `button` | `interactive` |
| **ุงูู Payload** | `messages.button.payload` | `messages.interactive.button_reply.id` |
| **ุงูุจุฏุก** | ููููู ุงูุจุฏุก | ุงูุนููู ูุจุฏุฃ |
| **ุงูุชูููุฉ** | ูุฌุงูู | ููุญุณุจ |

---

## โ Checklist

ูุจู ูุง ุชุฎุชุจุฑุ ุชุฃูุฏ ูู:

- [ ] ุฑูุนุช ุงูุชุญุฏูุซุงุช ุนูู Vercel
- [ ] Vercel ุฎูุต ุงูู deployment
- [ ] ุงูุฅุนุฏุงุฏุงุช ุตุญูุญุฉ ูู Template Settings
- [ ] ุงูู Template ูุนุชูุฏ ูู Meta (ูู ุจุชุณุชุฎุฏู Template)
- [ ] ุงูู Webhook URL ุตุญูุญ ูู Meta
- [ ] ุงูู phone_number_id ููุฌูุฏ ูู brands table
- [ ] ุงูู WhatsApp Token ุตุญูุญ
- [ ] Shopify ูุชุตู ูุดุบุงู

---

## ๐ ุงููุชูุฌุฉ ุงููุชููุนุฉ

ุจุนุฏ ุงูุงุฎุชุจุงุฑ:
- โ ุงูุจูุชููุงุช ุดุบุงูุฉ 100%
- โ ุงูุชุฃููุฏ ุจูุนูู Fulfillment
- โ ุงูุฅูุบุงุก ุจูุถูู Tag ุจุณ
- โ ุงูุฑุณุงุฆู ุงููุฎุตุตุฉ ุจุชุชุจุนุช
- โ Database ุจูุชุญุฏุซ ุตุญ
- โ Shopify ุจูุชุญุฏุซ ุตุญ

---

## ๐ ูู ูุญุชุงุฌ ูุณุงุนุฏุฉ

ุดุงุฑู ูุนุงูุง:
1. Screenshot ูู ุงูุฑุณุงูุฉ ุนูู ุงููุงุชุณุงุจ
2. Vercel Logs (ูู Functions tab)
3. Database query results
4. Shopify order details

---
ุชู ุงูุชุญุฏูุซ: ${new Date().toLocaleString('ar-EG')}
