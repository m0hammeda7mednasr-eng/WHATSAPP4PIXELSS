# ๐ฏ ุงูุญู ุงููุงูู ุงูููุงุฆู

## ุงููุดุงูู ุงูููุฌูุฏุฉ

### โ ุงููู ุดุบุงู:
- ุงูุฑุณุงูุฉ ุจุชูุตู ุนูู WhatsApp โ
- ุงูุนููู ุจูุดูู ุชูุงุตูู ุงูุฃูุฑุฏุฑ โ
- ุงูุนููู ุจููุฏุฑ ูุถุบุท "ุชุฃููุฏ" โ

### โ ุงููู ูุด ุดุบุงู:
- ููุง ุงูุนููู ูุถุบุท "ุชุฃููุฏ"ุ ูููุด ุฑุฏ โ
- ุงูุฑุณุงูุฉ ูู ุงูู CRM ูุด ูุงุถุญุฉ (Template: moon_order_confirmation) โ
- Button clicks ูุด ุจุชุชุณุฌู โ

---

## ๐ง ุงูุญููู (ุจุงูุชุฑุชูุจ)

### ุงูุญู 1: ุญุฏุซ ุงูู WhatsApp Token (ููู ุฌุฏุงู!)

**ุงูุณุจุจ:** Token ุงูุชูู ุงูุณุงุนุฉ 6:00 PM

**ุงูุฎุทูุงุช:**

1. ุงูุชุญ: https://developers.facebook.com/apps
2. ุงุฎุชุงุฑ App ุจุชุงุนู
3. WhatsApp โ API Setup
4. ุงูุณุฎ **Temporary access token** (ุจูุจุฏุฃ ุจู EAA...)
5. ุงูุชุญ ุงูู CRM: https://wahtsapp2.vercel.app
6. Settings โ Profile & WhatsApp
7. Edit ุงูุจุฑุงูุฏ "4 Pixels"
8. ุงูุตู Token ุงูุฌุฏูุฏ
9. Save โ

---

### ุงูุญู 2: ุชุฃูุฏ ูู WhatsApp Webhook Configuration

**ูู Meta Developer Console:**

1. ุงูุชุญ: https://developers.facebook.com/apps
2. ุงุฎุชุงุฑ App ุจุชุงุนู
3. WhatsApp โ Configuration
4. ูู **Webhook**:
   - Callback URL: `https://wahtsapp2.vercel.app/api/webhook`
   - Verify Token: `whatsapp_crm_2024`
5. ูู **Webhook fields**ุ ุชุฃูุฏ ุฅู ุฏูู ููุนููู:
   - โ messages
   - โ message_status (ุงุฎุชูุงุฑู)
6. ุงุถุบุท **Subscribe** โ

---

### ุงูุญู 3: ุดุบู SQL ูู Supabase

**ููู ุฌุฏุงู!** ูุงุฒู ุชุดุบู ุฏู ุนุดุงู order_id ูุดุชุบู:

1. ุงูุชุญ: https://supabase.com/dashboard/project/rmpgofswkpjxionzythf/editor

2. ุงูุณุฎ ูุงูุตู:

```sql
-- ุฅุถุงูุฉ order_id ูู messages
ALTER TABLE messages ADD COLUMN IF NOT EXISTS order_id UUID REFERENCES shopify_orders(id);
CREATE INDEX IF NOT EXISTS idx_messages_order_id ON messages(order_id);

-- ุฅุถุงูุฉ Template Settings
ALTER TABLE brands ADD COLUMN IF NOT EXISTS template_name TEXT DEFAULT 'moon_order_confirmation';
ALTER TABLE brands ADD COLUMN IF NOT EXISTS template_language TEXT DEFAULT 'ar';
ALTER TABLE brands ADD COLUMN IF NOT EXISTS use_template BOOLEAN DEFAULT true;
ALTER TABLE brands ADD COLUMN IF NOT EXISTS brand_emoji TEXT DEFAULT '๐';
ALTER TABLE brands ADD COLUMN IF NOT EXISTS welcome_message TEXT;
ALTER TABLE brands ADD COLUMN IF NOT EXISTS confirmation_message TEXT DEFAULT 'ุชู ุชุฃููุฏ ุทูุจู ุจูุฌุงุญ!';
ALTER TABLE brands ADD COLUMN IF NOT EXISTS cancellation_message TEXT DEFAULT 'ุชู ุฅูุบุงุก ุทูุจู.';
```

3. ุงุถุบุท **RUN** โ

---

### ุงูุญู 4: ุฃุถู Shopify Webhook (ูู ูุด ููุฌูุฏ)

**ูู Shopify Admin:**

1. Settings โ Notifications
2. scroll ูู **Webhooks**
3. ุงุถุบุท **Create webhook**
4. ุงููุฃ:
   - Event: **Order creation**
   - Format: **JSON**
   - URL: `https://wahtsapp2.vercel.app/api/shopify/webhook-handler`
5. Save โ

---

## ๐งช ุงุฎุชุจุงุฑ ูุงูู

### ุงูุฎุทูุฉ 1: ุงุฎุชุจุฑ ุงูู Token

```bash
node diagnose-whatsapp.js
```

ูุงุฒู ูุทูุน:
```
โ Token valid
โ Phone: +20 12 88429700
โ Quality: GREEN
```

---

### ุงูุฎุทูุฉ 2: ุงุฎุชุจุฑ ูู ุงูู CRM

1. ุงูุชุญ ุงูู CRM
2. ุงุฎุชุงุฑ ุฃู contact
3. ุงุจุนุช ุฑุณุงูุฉ test
4. ูู ูุตูุชุ ูุจูู Token ุดุบุงู โ

---

### ุงูุฎุทูุฉ 3: ุงุฎุชุจุฑ Shopify Order

1. ุงุนูู test order ูู Shopify
2. ุถุน ุฑูู ูุงุชุณุงุจ ุตุญูุญ (ุจููุฏ ุงูุฏููุฉ)
3. ุงุณุชูู 10-30 ุซุงููุฉ
4. ุดูู WhatsApp - ุงูููุฑูุถ ุงูุฑุณุงูุฉ ุชูุตู
5. ุงุถุบุท "ุชุฃููุฏ"
6. ุงูููุฑูุถ ุชุฑุฌุนูู ุฑุณุงูุฉ: "ุชู ุชุฃููุฏ ุทูุจู ุจูุฌุงุญ!"

---

## ๐ฑ ุงูู Flow ุงูุตุญูุญ

```
1. Order ูู Shopify
   โ
2. Shopify Webhook โ api/shopify/webhook-handler
   โ
3. ุงูุณูุณุชู ูุญูุธ Order ูู database
   โ
4. ูุจุนุช ุฑุณุงูุฉ WhatsApp ููุนููู (ูุน buttons)
   โ
5. ูุญูุธ ุงูุฑุณุงูุฉ ูู messages ูุน order_id
   โ
6. ุงูุนููู ูุถุบุท "ุชุฃููุฏ"
   โ
7. WhatsApp Webhook โ api/webhook
   โ
8. ุงูุณูุณุชู ูุณุชูุจู button click
   โ
9. ูุณุชุฏุนู api/shopify/handle-button-click
   โ
10. ูุจุนุช ุฑุณุงูุฉ ุชุฃููุฏ ููุนููู
    โ
11. ูุญุฏุซ Order status ูู Shopify
    โ
12. ูุญูุธ ูู ุงูุฑุณุงุฆู ูู database
    โ
13. ูู ุญุงุฌุฉ ุชุธูุฑ ูู ุงูู CRM! ๐
```

---

## ๐ ูู ูุณู ูุด ุดุบุงู

### ุชุญูู ูู Vercel Logs:

1. ุงูุชุญ: https://vercel.com/dashboard
2. ุงุฎุชุงุฑ ุงููุดุฑูุน
3. Logs
4. ุงุจุญุซ ุนู:
   - `shopify webhook`
   - `button clicked`
   - `interactive message`

### ุชุญูู ูู Meta Webhook Logs:

1. Meta Developer Console
2. WhatsApp โ Configuration
3. Webhook โ Test
4. ุดูู ุงูู response

---

## โ ุงูุฎูุงุตุฉ

**ุงููุทููุจ (ุจุงูุชุฑุชูุจ):**

1. โ ุญุฏุซ WhatsApp Token (ุฃูู ุญุงุฌุฉ!)
2. โ ุชุฃูุฏ ูู WhatsApp Webhook ูู Meta
3. โ ุดุบู SQL ูู Supabase
4. โ ุชุฃูุฏ ูู Shopify Webhook
5. โ ุงุนูู test order ุฌุฏูุฏ

**ุงููุชูุฌุฉ:**
- ุงูุฑุณุงูุฉ ุชูุตู โ
- ุงูุนููู ูุถุบุท ุชุฃููุฏ โ
- ูุฑุฌุนูู ุฑุณุงูุฉ ุชุฃููุฏ โ
- ูู ุญุงุฌุฉ ุชุธูุฑ ูู ุงูู CRM โ
- Order status ูุชุญุฏุซ ูู Shopify โ

---

**๐ ุงุจุฏุฃ ุจุชุญุฏูุซ ุงูู Token ุงูุฃููุ ูุจุนุฏูู ุฌุฑุจ!**
