# ğŸš€ WhatsApp CRM - Complete System

## Ù†Ø¸Ø§Ù… CRM Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø­Ø§Ø¯Ø«Ø§Øª WhatsApp Ù…Ø¹ ØªÙƒØ§Ù…Ù„ Shopify

---

## âœ¨ Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª

### ğŸ’¬ WhatsApp Integration
- âœ… Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
- âœ… Ø¯Ø¹Ù… Ø§Ù„ÙˆØ³Ø§Ø¦Ø· (ØµÙˆØ±ØŒ ÙÙŠØ¯ÙŠÙˆØŒ Ù…Ø³ØªÙ†Ø¯Ø§ØªØŒ ØµÙˆØª)
- âœ… Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (sent, delivered, read)
- âœ… Multi-tenant (Ø¹Ø¯Ø© Ø¨Ø±Ø§Ù†Ø¯Ø§Øª)

### ğŸ›’ Shopify Integration
- âœ… ØªÙƒØ§Ù…Ù„ Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹ Shopify (Ø¨Ø¯ÙˆÙ† n8n)
- âœ… Ø¥Ø±Ø³Ø§Ù„ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- âœ… Interactive Buttons (ØªØ£ÙƒÙŠØ¯/Ø¥Ù„ØºØ§Ø¡)
- âœ… Template Messages Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† Meta
- âœ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Shopify
- âœ… Abandoned Cart Reminders

### ğŸ¨ Template Customization
- âœ… ÙƒÙ„ Ø¨Ø±Ø§Ù†Ø¯ ÙŠÙ‚Ø¯Ø± ÙŠØ®ØµØµ Ø±Ø³Ø§Ø¦Ù„Ù‡
- âœ… Ø§Ø®ØªÙŠØ§Ø± Template Name Ùˆ Language
- âœ… ØªØ®ØµÙŠØµ Emoji Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯
- âœ… Ø±Ø³Ø§Ø¦Ù„ Ù…Ø®ØµØµØ© Ù„Ù„ØªØ£ÙƒÙŠØ¯ ÙˆØ§Ù„Ø¥Ù„ØºØ§Ø¡
- âœ… Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø±Ø³Ø§Ø¦Ù„

### ğŸ“Š Dashboard Features
- âœ… Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù…Ø¹ Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø©
- âœ… Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£ÙˆØ±Ø¯Ø± ÙÙŠ Ø§Ù„Ø´Ø§Øª
- âœ… Ø¥Ø¯Ø§Ø±Ø© Ø¹Ø¯Ø© Ø¨Ø±Ø§Ù†Ø¯Ø§Øª
- âœ… Settings Ø´Ø§Ù…Ù„Ø©
- âœ… Shopify Orders Management

---

## ğŸ—ï¸ Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©

### Frontend
- React + Vite
- Tailwind CSS
- Lucide Icons
- Supabase Client

### Backend
- Vercel Serverless Functions
- Supabase (PostgreSQL)
- WhatsApp Business API
- Shopify API

### APIs
- `/api/send-message` - Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ WhatsApp
- `/api/external-message` - Ø¥Ø±Ø³Ø§Ù„ Ù…Ù† Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø¸Ø§Ù…
- `/api/webhook` - Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ WhatsApp
- `/api/shopify/webhook-handler` - Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Shopify webhooks
- `/api/shopify/handle-button-click` - Ù…Ø¹Ø§Ù„Ø¬Ø© button clicks
- `/api/shopify/oauth/callback` - Shopify OAuth

---

## ğŸ“‹ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª

### 1. Meta Developer Account
- WhatsApp Business App
- Phone Number ID
- Access Token
- Webhook Configuration

### 2. Shopify Store
- Admin API Access
- Webhook Configuration
- (Optional) OAuth App

### 3. Supabase Project
- Database Tables
- RLS Policies
- Storage Bucket (optional)

### 4. Vercel Account
- Project Deployment
- Environment Variables

---

## ğŸš€ Ø§Ù„ØªØ«Ø¨ÙŠØª ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯

### Ø§Ù„Ø®Ø·ÙˆØ© 1: Clone Repository

```bash
git clone https://github.com/m0hammedahmed/wahtsapp.git
cd wahtsapp
npm install
```

### Ø§Ù„Ø®Ø·ÙˆØ© 2: Environment Variables

Ø£Ù†Ø´Ø¦ Ù…Ù„Ù `.env`:

```env
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
WEBHOOK_VERIFY_TOKEN=whatsapp_crm_2024
```

### Ø§Ù„Ø®Ø·ÙˆØ© 3: Database Setup

Ø´ØºÙ„ SQL ÙÙŠ Supabase:

```sql
-- Ù…Ù† Ù…Ù„Ù: COMPLETE-SHOPIFY-SETUP.sql
-- ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ù€ RLS policies
```

### Ø§Ù„Ø®Ø·ÙˆØ© 4: Deploy to Vercel

```bash
vercel --prod
```

Ø£Ùˆ:
- Push to GitHub
- Connect to Vercel
- Auto-deploy

---

## âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯

### 1. WhatsApp Configuration

**ÙÙŠ Meta Developer Console:**
1. WhatsApp â†’ Configuration
2. Webhook:
   - URL: `https://your-domain.vercel.app/api/webhook`
   - Verify Token: `whatsapp_crm_2024`
3. Subscribe to: `messages`

**ÙÙŠ Ø§Ù„Ù€ CRM:**
1. Settings â†’ Profile & WhatsApp
2. Ø£Ø¶Ù:
   - WhatsApp Access Token
   - Phone Number ID
3. Save

### 2. Shopify Configuration

**ÙÙŠ Shopify Admin:**
1. Settings â†’ Notifications â†’ Webhooks
2. Create webhook:
   - Event: Order creation
   - URL: `https://your-domain.vercel.app/api/shopify/webhook-handler`
   - Format: JSON

**ÙÙŠ Ø§Ù„Ù€ CRM:**
1. Settings â†’ Shopify Integration
2. Ø§Ø®ØªØ±:
   - Manual Token (Ø£Ø³Ù‡Ù„)
   - Ø£Ùˆ OAuth (Ø£ÙƒØ«Ø± Ø£Ù…Ø§Ù†Ø§Ù‹)
3. Ø£Ø¯Ø®Ù„ Shop URL Ùˆ Access Token
4. Save

### 3. Template Messages

**ÙÙŠ Meta Business Manager:**
1. Message Templates
2. Create Template:
   - Name: `moon2` (Ø£Ùˆ Ø£ÙŠ Ø§Ø³Ù…)
   - Category: TRANSACTIONAL
   - Language: English/Arabic
   - Add Variables: {{1}} to {{7}}
   - Add Quick Reply Buttons
3. Submit Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø©

**ÙÙŠ Ø§Ù„Ù€ CRM:**
1. Settings â†’ Message Templates
2. Ø£Ø¯Ø®Ù„:
   - Template Name: `moon2`
   - Language: `en`
   - Enable Template
3. Save

---

## ğŸ“± Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

### Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©

1. Ø§Ø®ØªØ± Contact Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
2. Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
3. (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø£Ø±ÙÙ‚ Ù…Ù„Ù
4. Ø§Ø¶ØºØ· Send

### Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ù„Ø©

- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØªØ¸Ù‡Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- Real-time updates
- Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© (delivered/read)

### Shopify Order Flow

```
1. Ø¹Ù…ÙŠÙ„ ÙŠØ·Ù„Ø¨ Ù…Ù† Shopify
   â†“
2. Shopify ÙŠØ¨Ø¹Øª Webhook
   â†“
3. Ø§Ù„Ø³ÙŠØ³ØªÙ… ÙŠØ¨Ø¹Øª Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯
   â†“
4. Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙŠØ¶ØºØ· "ØªØ£ÙƒÙŠØ¯"
   â†“
5. Ø§Ù„Ø³ÙŠØ³ØªÙ… ÙŠØ­Ø¯Ø« Shopify
   â†“
6. ÙƒÙ„ Ø­Ø§Ø¬Ø© ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù€ CRM
```

---

## ğŸ—‚ï¸ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹

```
wahtsapp/
â”œâ”€â”€ api/                          # Vercel Serverless Functions
â”‚   â”œâ”€â”€ send-message.js          # Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„
â”‚   â”œâ”€â”€ external-message.js      # API Ø®Ø§Ø±Ø¬ÙŠ
â”‚   â”œâ”€â”€ webhook.js               # WhatsApp webhook
â”‚   â””â”€â”€ shopify/
â”‚       â”œâ”€â”€ webhook-handler.js   # Shopify webhooks
â”‚       â”œâ”€â”€ handle-button-click.js
â”‚       â””â”€â”€ oauth/
â”‚           â””â”€â”€ callback.js
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/              # React Components
â”‚   â”‚   â”œâ”€â”€ ChatWindow.jsx
â”‚   â”‚   â”œâ”€â”€ ChatList.jsx
â”‚   â”‚   â”œâ”€â”€ SettingsComplete.jsx
â”‚   â”‚   â”œâ”€â”€ TemplateSettings.jsx
â”‚   â”‚   â”œâ”€â”€ ShopifyOAuth.jsx
â”‚   â”‚   â”œâ”€â”€ ShopifyOrders.jsx
â”‚   â”‚   â””â”€â”€ OrderMessageCard.jsx
â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â””â”€â”€ BrandContext.jsx
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ supabaseClient.js
â”‚   â””â”€â”€ config.js
â”œâ”€â”€ *.sql                        # Database Setup Files
â”œâ”€â”€ *.md                         # Documentation (Arabic)
â””â”€â”€ package.json
```

---

## ğŸ“š Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù‡Ù…Ø©

### Setup Guides
- `COMPLETE-SHOPIFY-SETUP.sql` - Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ² Ø§Ù„ÙƒØ§Ù…Ù„
- `Ø§Ø³ØªØ®Ø¯Ø§Ù…-template-moon2.md` - Ø¯Ù„ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… Templates
- `Ø§ØµÙ„Ø§Ø­-Ø´ÙˆØ¨ÙØ§ÙŠ-webhook.md` - Ø¥Ø¹Ø¯Ø§Ø¯ Shopify Webhooks
- `Ø­Ø¯Ø«-Ø§Ù„ØªÙˆÙƒÙ†-Ø§Ù„Ø§Ù†.md` - ØªØ­Ø¯ÙŠØ« WhatsApp Token

### Documentation
- `SHOPIFY-DIRECT-INTEGRATION.md` - Ø´Ø±Ø­ ØªÙƒØ§Ù…Ù„ Shopify
- `Ø§Ù„Ù†Ø¸Ø§Ù…-Ø§Ù„ÙƒØ§Ù…Ù„-Ø¬Ø§Ù‡Ø².md` - Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„
- `ØªÙ…-Ø§ØµÙ„Ø§Ø­-Ø§Ù„Ø¨ÙˆØªÙˆÙ†Ø§Øª.md` - Ø­Ù„ Ù…Ø´Ø§ÙƒÙ„ Buttons

---

## ğŸ”§ Ø§Ù„ØµÙŠØ§Ù†Ø©

### ØªØ­Ø¯ÙŠØ« WhatsApp Token

**Temporary Token (ÙŠÙ†ØªÙ‡ÙŠ ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©):**
```bash
node quick-update-token.js
```

**Permanent Token (Ù…ÙˆØµÙ‰ Ø¨Ù‡):**
1. Meta Business Manager
2. System Users
3. Generate Token (Never expires)
4. Ø­Ø¯Ø«Ù‡ ÙÙŠ Ø§Ù„Ù€ CRM

### Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

**Vercel Logs:**
```
https://vercel.com/dashboard â†’ Logs
```

**Supabase Logs:**
```
Supabase Dashboard â†’ Logs
```

---

## ğŸ†˜ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

### Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ø´ Ø¨ØªÙˆØµÙ„

1. ØªØ­Ù‚Ù‚ Ù…Ù† WhatsApp Token
2. ØªØ­Ù‚Ù‚ Ù…Ù† Webhook Configuration
3. Ø´ÙˆÙ Vercel Logs

### Shopify Orders Ù…Ø´ Ø¨ØªØ¸Ù‡Ø±

1. ØªØ­Ù‚Ù‚ Ù…Ù† Shopify Webhook
2. ØªØ­Ù‚Ù‚ Ù…Ù† Shopify Connection ÙÙŠ Ø§Ù„Ù€ CRM
3. Ø´ÙˆÙ Database Tables

### Buttons Ù…Ø´ Ø´ØºØ§Ù„Ø©

1. ØªØ£ÙƒØ¯ Ù…Ù† WhatsApp Webhook
2. ØªØ£ÙƒØ¯ Ù…Ù† Subscribe to `messages`
3. Ø¬Ø±Ø¨ Interactive Message Ø¨Ø¯Ù„ Template

---

## ğŸ“Š Database Schema

### Tables
- `brands` - Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯Ø§Øª
- `contacts` - Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
- `messages` - Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
- `shopify_connections` - Ø§ØªØµØ§Ù„Ø§Øª Shopify
- `shopify_orders` - Ø§Ù„Ø·Ù„Ø¨Ø§Øª
- `shopify_webhook_logs` - Ø³Ø¬Ù„ Webhooks

### Key Columns
- `messages.order_id` - Ø±Ø¨Ø· Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø§Ù„Ø£ÙˆØ±Ø¯Ø±
- `brands.template_name` - Ø§Ø³Ù… Ø§Ù„Ù€ Template
- `brands.use_template` - ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Template

---

## ğŸ” Ø§Ù„Ø£Ù…Ø§Ù†

- âœ… RLS Policies Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
- âœ… Webhook Verification
- âœ… Environment Variables
- âœ… CORS Configuration
- âœ… Multi-tenant Isolation

---

## ğŸš€ Production Checklist

- [ ] WhatsApp Token Ù…Ø­Ø¯Ø«
- [ ] Webhook Ù…ØªÙˆØµÙ„ ÙˆÙ…ØªØ­Ù‚Ù‚ Ù…Ù†Ù‡
- [ ] Shopify Webhook Ù…Ø¶Ø§Ù
- [ ] Database Tables Ù…ÙˆØ¬ÙˆØ¯Ø©
- [ ] RLS Policies Ù…ÙØ¹Ù„Ø©
- [ ] Template Messages Ù…Ø¹ØªÙ…Ø¯Ø©
- [ ] Environment Variables ØµØ­ÙŠØ­Ø©
- [ ] Vercel Deployment Ù†Ø§Ø¬Ø­

---

## ğŸ“ Ø§Ù„Ø¯Ø¹Ù…

Ù„Ù„Ù…Ø´Ø§ÙƒÙ„ ÙˆØ§Ù„Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª:
- GitHub Issues
- Documentation Files (*.md)

---

## ğŸ“ License

MIT License

---

## ğŸ‰ Contributors

- Mohammed Ahmed (@m0hammedahmed)

---

**ğŸš€ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ù†ØªØ§Ø¬!**

**Live Demo:** https://wahtsapp2.vercel.app

**GitHub:** https://github.com/m0hammedahmed/wahtsapp
