# ๐ ุงูุฎูุงุตุฉ - ูู ูุง ุชุญุชุงุฌู ูุฑุจุท Shopify

## ๐ฏ ุงููุฏู
ุฑุจุท Shopify ุจุงููุธุงู ูุฅุฑุณุงู ุชุฃููุฏุงุช ุงูุทูุจุงุช ุนุจุฑ WhatsApp ูุน ุฃุฒุฑุงุฑ ุชูุงุนููุฉ

---

## โ ูุง ุชู ุนููู

### 1. Backend APIs โ
- `api/shopify/oauth/callback.js` - ูุนุงูุฌุฉ OAuth ูู Shopify
- `api/shopify/send-order-confirmation.js` - ุฅุฑุณุงู ุฑุณุงุฆู WhatsApp
- `api/shopify/handle-button-click.js` - ูุนุงูุฌุฉ ุถุบุท ุงูุฃุฒุฑุงุฑ

### 2. Frontend Components โ
- `src/components/SettingsComplete.jsx` - ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช ุงูุฑุฆูุณูุฉ
- `src/components/ShopifyOAuth.jsx` - ูุงุฌูุฉ ุฑุจุท Shopify
- `src/components/ShopifyOrders.jsx` - ุนุฑุถ ุงูุทูุจุงุช

### 3. Database Schema โ
- `COMPLETE-SHOPIFY-SETUP.sql` - ูู ุงูุฌุฏุงูู ูุงูู RLS
- ุฌุฏุงูู: shopify_connections, shopify_orders, shopify_webhook_logs

### 4. Testing Scripts โ
- `test-shopify-setup.js` - ุงุฎุชุจุงุฑ ุดุงูู
- `check-tables.js` - ูุญุต ุงูุฌุฏุงูู
- `check-shopify-connection.js` - ูุญุต ุงูุงุชุตุงู

### 5. Documentation โ
- `SHOPIFY-SETUP-ARABIC.md` - ุฏููู ูุงูู ุจุงูุนุฑุจู
- `ุงุจุฏุฃ-ููุง-ุดูุจูุงู.md` - ุฏููู ุณุฑูุน 3 ุฎุทูุงุช
- `VERCEL-SHOPIFY-ENV.md` - ุฅุนุฏุงุฏ Vercel

---

## ๐ ุฎุทูุงุช ุงูุชุดุบูู (ุจุงูุชุฑุชูุจ)

### ุงูุฎุทูุฉ 1: ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
# 1. ุงูุชุญ Supabase SQL Editor
https://supabase.com/dashboard/project/rmpgofswkpjxionzythf/sql/new

# 2. ุงูุณุฎ ูุงูุตู ูุญุชูู ููู:
COMPLETE-SHOPIFY-SETUP.sql

# 3. ุงุถุบุท Run

# 4. ุชุญูู ูู ุงููุฌุงุญ:
node test-shopify-setup.js
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
๐ SUCCESS! All tests passed!
โ Database is ready for Shopify integration
```

---

### ุงูุฎุทูุฉ 2: ุฅุนุฏุงุฏ Vercel Environment Variables

```bash
# ูู Vercel Dashboard:
# Settings โ Environment Variables

# ุฃุถู:
VITE_APP_URL = https://wahtsapp2.vercel.app

# ุซู:
Redeploy
```

**ุฃู ุจุงุณุชุฎุฏุงู CLI:**
```bash
vercel env add VITE_APP_URL
# ุฃุฏุฎู: https://wahtsapp2.vercel.app

vercel --prod
```

---

### ุงูุฎุทูุฉ 3: ุฅุนุฏุงุฏ Shopify App

**ูู Shopify Admin:**
```
Settings โ Apps โ Develop apps โ Create an app
```

**ุงุณู ุงูุชุทุจูู:**
```
WhatsApp CRM
```

**Configuration โ App URL:**
```
https://wahtsapp2.vercel.app/api/shopify/oauth/callback
```

**Configure Admin API scopes:**
- โ read_orders
- โ write_orders

**API credentials โ Copy:**
- Client ID
- Client Secret

---

### ุงูุฎุทูุฉ 4: ุงูุฑุจุท

**ุงูุชุญ:**
```
https://wahtsapp2.vercel.app
```

**ุงุฐูุจ ุฅูู:**
```
Settings โ Shopify Integration
```

**ุงููุฃ:**
- Shop Subdomain: `your-store` (ุจุฏูู .myshopify.com)
- Client ID: [ุงูุตูู ูู Shopify]
- Client Secret: [ุงูุตูู ูู Shopify]
- โ Use OAuth (Recommended)

**ุงุถุบุท:**
```
Connect with OAuth
```

---

## โ ุนูุงูุงุช ุงููุฌุงุญ

### ูู Settings โ Shopify Integration:
- โ Badge ุฃุฎุถุฑ "Connected"
- โ ุงุณู ุงููุชุฌุฑ ุธุงูุฑ
- โ ุชุงุฑูุฎ ุงูุฑุจุท ุธุงูุฑ
- โ ุฒุฑ "Test Connection" ูุนูู

### ูู Settings โ Profile & WhatsApp:
- โ ูู ุงูุฃุณูู: "Shopify Connected: your-store.myshopify.com"

### ูู Settings โ Shopify Orders:
- โ ุฌุฏูู ุงูุทูุจุงุช ูุธูุฑ (ุญุชู ูู ูุงุฑุบ)
- โ Filters ุชุนูู

---

## ๐ฏ ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุฅุฑุณุงู ุชุฃููุฏ ุทูุจ

**ูู n8n ุฃู webhook:**
```javascript
POST https://wahtsapp2.vercel.app/api/shopify/send-order-confirmation

{
  "brandId": "d1678581-bc57-4d01-9f35-b0bdc4edcd77",
  "orderId": "5678901234",
  "orderNumber": "#1234",
  "customerPhone": "201234567890",
  "customerName": "ุฃุญูุฏ ูุญูุฏ",
  "totalPrice": "500.00",
  "currency": "EGP",
  "items": [
    {
      "name": "ููุชุฌ 1",
      "quantity": 2,
      "price": "250.00"
    }
  ]
}
```

### 2. ุงูุฑุณุงูุฉ ุงูุชู ูุณุชูุจููุง ุงูุนููู

```
๐๏ธ ุทูุจ ุฌุฏูุฏ #1234

ูุฑุญุจุงู ุฃุญูุฏ ูุญูุฏ!

ุชู ุงุณุชูุงู ุทูุจู ุจูุฌุงุญ:
โข ููุชุฌ 1 ร 2 - 250.00 EGP

๐ฐ ุงูุฅุฌูุงูู: 500.00 EGP

[ุฒุฑ: โ ุชุฃููุฏ ุงูุทูุจ]
[ุฒุฑ: โ ุฅูุบุงุก ุงูุทูุจ]
```

### 3. ุนูุฏ ุถุบุท ุงูุนููู

**ุฅุฐุง ุถุบุท "ุชุฃููุฏ":**
- โ ูุชู ุชุญุฏูุซ Shopify Order
- โ ูุชู ุญูุธ ุงูุญุงูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุธูุฑ ูู Shopify Orders tab

**ุฅุฐุง ุถุบุท "ุฅูุบุงุก":**
- โ ูุชู ุฅูุบุงุก ุงูุทูุจ ูู Shopify
- โ ูุชู ุชุญุฏูุซ ุงูุญุงูุฉ
- โ ูุธูุฑ ูู "Cancelled" ูู Orders tab

---

## ๐ง ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### 1. "Not Connected" ุจุนุฏ ุชุดุบูู SQL
```bash
node check-tables.js
```
ูุฌุจ ุฃู ุชุฑู โ ุจุฌุงูุจ ูู ุฌุฏูู

**ุฅุฐุง ุฑุฃูุช โ:**
- ุดุบูู SQL ูุฑุฉ ุฃุฎุฑู ูู Supabase
- ุชุฃูุฏ ูู ูุณุฎ ุงูููู ูุงููุงู

---

### 2. "Buffer is not defined"
โ **ุชู ุญููุง!** ูุณุชุฎุฏู `btoa()` ุงูุขู

---

### 3. "Invalid credentials"
**ุงูุฃุณุจุงุจ:**
- Client ID ุฎุทุฃ
- Client Secret ุฎุทุฃ
- Shop Subdomain ุฎุทุฃ

**ุงูุญู:**
- ุงูุณุฎ ูู Shopify ูุฑุฉ ุฃุฎุฑู
- ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ูุณุงูุงุช
- Shop Subdomain ุจุฏูู .myshopify.com

---

### 4. OAuth Redirect ูุดู
**ุงูุณุจุจ:** Redirect URL ุบูุฑ ุตุญูุญ

**ุงูุญู:**
ูู Shopify App โ Configuration โ App URL:
```
https://wahtsapp2.vercel.app/api/shopify/oauth/callback
```

---

### 5. ุงูุจูุงูุงุช ุชุฎุชูู ุจุนุฏ Refresh
**ุงูุณุจุจ:** ุงูุฌุฏุงูู ุบูุฑ ููุฌูุฏุฉ

**ุงูุญู:**
```bash
node test-shopify-setup.js
```
ุฅุฐุง ูุดูุ ุดุบูู SQL ูุฑุฉ ุฃุฎุฑู

---

### 6. OAuth ูุญูู ุฅูู localhost
**ุงูุณุจุจ:** VITE_APP_URL ุบูุฑ ูุถุจูุท ูู Vercel

**ุงูุญู:**
1. Vercel Dashboard โ Settings โ Environment Variables
2. ุฃุถู: `VITE_APP_URL = https://wahtsapp2.vercel.app`
3. Redeploy

---

## ๐ ุงููููุงุช ุงููููุฉ

### SQL & Database:
- `COMPLETE-SHOPIFY-SETUP.sql` โญ ุงูุฃูู
- `database-shopify-integration.sql`
- `add-shopify-columns.sql`

### Testing:
- `test-shopify-setup.js` โญ ุงูุฃูู
- `check-tables.js`
- `check-shopify-connection.js`
- `test-shopify-order-confirmation.js`

### Documentation:
- `SHOPIFY-SETUP-ARABIC.md` โญ ุฏููู ูุงูู
- `ุงุจุฏุฃ-ููุง-ุดูุจูุงู.md` โญ ุฏููู ุณุฑูุน
- `VERCEL-SHOPIFY-ENV.md`
- `FIX-SHOPIFY-NOW.md`

### Frontend:
- `src/components/SettingsComplete.jsx`
- `src/components/ShopifyOAuth.jsx`
- `src/components/ShopifyOrders.jsx`

### Backend:
- `api/shopify/oauth/callback.js`
- `api/shopify/send-order-confirmation.js`
- `api/shopify/handle-button-click.js`

---

## โ Checklist ุงูููุงุฆู

### ูุจู ุงูุจุฏุก:
- [ ] Supabase ูุชุงุญ
- [ ] Vercel ูุชุงุญ
- [ ] Shopify Admin ูุชุงุญ
- [ ] ูุฏูู ุตูุงุญูุงุช ุฅูุดุงุก Apps ูู Shopify

### ุฅุนุฏุงุฏ Database:
- [ ] ุชุดุบูู `COMPLETE-SHOPIFY-SETUP.sql` ูู Supabase
- [ ] `node test-shopify-setup.js` ูุนุทู โ
- [ ] `node check-tables.js` ูุนุทู โ

### ุฅุนุฏุงุฏ Vercel:
- [ ] ุฅุถุงูุฉ `VITE_APP_URL` ูู Environment Variables
- [ ] Redeploy ุจุนุฏ ุฅุถุงูุฉ ุงููุชุบูุฑ
- [ ] ุงูุชุฃูุฏ ูู ุฃู ุงููููุน ูุนูู

### ุฅุนุฏุงุฏ Shopify:
- [ ] ุฅูุดุงุก App ุฌุฏูุฏ
- [ ] ุถุจุท App URL (Redirect URL)
- [ ] ุชูุนูู Permissions (read_orders, write_orders)
- [ ] ูุณุฎ Client ID ู Client Secret

### ุงูุฑุจุท:
- [ ] ูุชุญ Settings โ Shopify Integration
- [ ] ููุก Shop Subdomain (ุจุฏูู .myshopify.com)
- [ ] ููุก Client ID
- [ ] ููุก Client Secret
- [ ] ุชูุนูู OAuth
- [ ] ุงูุถุบุท ุนูู Connect

### ุงูุชุญูู:
- [ ] Badge ุฃุฎุถุฑ "Connected" ุธุงูุฑ
- [ ] ุงุณู ุงููุชุฌุฑ ุธุงูุฑ
- [ ] Test Connection ูุนูู
- [ ] ูู Profile: Shopify Connected ุธุงูุฑ
- [ ] Shopify Orders tab ูุนูู

---

## ๐ ุงููุฌุงุญ!

ุฅุฐุง ุฃูููุช ูู ุงูู Checklist:
- โ ุงููุธุงู ุฌุงูุฒ 100%
- โ ููููู ุฅุฑุณุงู ุชุฃููุฏุงุช ุงูุทูุจุงุช
- โ ุงูุนููุงุก ูููููู ุงูุชูุงุนู ุจุงูุฃุฒุฑุงุฑ
- โ Shopify ูุชุญุฏุซ ุชููุงุฆูุงู
- โ ูู ุดูุก ูุญููุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ๐ ููุฏุนู

ุฅุฐุง ูุงุฌูุช ูุดููุฉ:

1. **ุดุบูู ุงูุงุฎุชุจุงุฑุงุช:**
```bash
node test-shopify-setup.js
node check-tables.js
```

2. **ุงูุญุต Console:**
- ุงูุชุญ ุงููุชุตูุญ
- ุงุถุบุท F12
- ุงุฐูุจ ุฅูู Console
- ุฎุฐ screenshot ูู ุฃู ุฃุฎุทุงุก

3. **ุฃุฑุณู:**
- Screenshot ูู ุงูุงุฎุชุจุงุฑุงุช
- Screenshot ูู Console
- ูุตู ุงููุดููุฉ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

ุจุนุฏ ูุฌุงุญ ุงูุฑุจุท:
1. ุงุฑุจุท n8n ูุน Shopify ูุงุณุชูุจุงู ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ
2. ุนูุฏ ุทูุจ ุฌุฏูุฏุ ุฃุฑุณู POST request ููู API
3. ุฑุงูุจ ุงูุทูุจุงุช ูู Shopify Orders tab
4. ุชุงุจุน ุชูุงุนู ุงูุนููุงุก

---

**ุขุฎุฑ ุชุญุฏูุซ:** ุงูุขู
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู 100%
**ุงูุฅุตุฏุงุฑ:** 1.0.0

**ุชู ุจุญูุฏ ุงููู! ๐**
