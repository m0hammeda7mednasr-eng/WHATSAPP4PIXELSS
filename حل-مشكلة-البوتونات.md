# ๐ง ุญู ูุดููุฉ ุงูุจูุชููุงุช - ุฏููู ุณุฑูุน

## ๐ฏ ุงููุดููุฉ

ููุง ุงูุนููู ูุถุบุท "ุชุฃููุฏ" ุฃู "ุฅูุบุงุก" ุนูู WhatsApp:
- โ ูููุด ุฑุฏ ุจูุฑุฌุน ููุนููู
- โ Order status ูุด ุจูุชุญุฏุซ ูู Shopify
- โ ูููุด ุญุงุฌุฉ ุจุชุญุตู ุฎุงูุต

---

## ๐ก ุงูุณุจุจ

**WhatsApp Webhook ูุด ูุชูุตู ุตุญ!**

ููุง ุงูุนููู ูุถุบุท Buttonุ WhatsApp ุจูุจุนุช ุฅุดุนุงุฑ ููุณูุณุชู.
ูู ุงูู Webhook ูุด ุดุบุงูุ ุงูุณูุณุชู ูุด ููุนุฑู ุฅู ุงูุนููู ุถุบุท ุญุงุฌุฉ.

---

## โ ุงูุญู (3 ุฎุทูุงุช ุจุณ)

### ุงูุฎุทูุฉ 1๏ธโฃ: ุงูุชุญ Meta Developer Console

1. ุฑูุญ ุนูู: **https://developers.facebook.com/apps**
2. ุงุฎุชุงุฑ ุงูู App ุจุชุงุนู
3. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ: **WhatsApp** โ **Configuration**

---

### ุงูุฎุทูุฉ 2๏ธโฃ: ุชุญูู ูู Webhook Settings

ูู ูุณู **Webhook**ุ ุชุฃูุฏ ูู:

```
โ Callback URL:
https://wahtsapp2.vercel.app/api/webhook

โ Verify token:
whatsapp_crm_2024
```

**ููู ุฌุฏุงู:** ูู ุงูู URL ุฃู Token ุบูุทุ ุงุถุบุท **Edit** ูุตุญุญูู.

---

### ุงูุฎุทูุฉ 3๏ธโฃ: Subscribe to Messages

ูู ููุณ ุงูุตูุญุฉุ ุชุญุช **Webhook fields**:

1. ูุงูู **messages** โ ุงุถุบุท **Subscribe** โ
2. ูุงูู **message_status** โ ุงุถุบุท **Subscribe** โ (ุงุฎุชูุงุฑู)

**ููุญูุธุฉ:** ูู ููุชูุจ "Subscribed" ุจุงููุนูุ ูุจูู ุชูุงู โ

---

## ๐งช ุงุฎุชุจุฑ ุงูู Webhook

### ูู Meta Console:

1. ูู ููุณ ุตูุญุฉ Webhook Configuration
2. ุงุถุบุท **Test** ุจุฌุงูุจ ุงูู webhook
3. ุงุฎุชุงุฑ **messages**
4. ุงุถุบุท **Send Test**
5. ูุงุฒู ูุทูุน: โ **Success**

ูู ุทูุน โ **Failed**:
- ุชุญูู ูู Callback URL
- ุชุญูู ูู Verify Token
- ุดูู Vercel Logs

---

### ูู Terminal:

```bash
node test-button-webhook.js
```

ูุงุฒู ูุทูุน:
```
โ Webhook verification: SUCCESS
   Response: test123
```

---

## ๐ฑ ุงุฎุชุจุฑ ูู WhatsApp

### ุงูุทุฑููุฉ ุงูุตุญูุญุฉ:

1. **ุงุจุนุช ุฑุณุงูุฉ ููุจุฑุงูุฏ** ูู ุฑููู ุนูู WhatsApp
   - ูุซูุงู: "ูุฑุญุจุง"

2. **ุงูุจุฑุงูุฏ ูุฑุฏ ุนููู** ุจุฑุณุงูุฉ ูููุง buttons
   - ูู ูุฑุฏุด โ Token ููุชูู (ุดูู ุงูุฎุทูุฉ ุงูุชุงููุฉ)

3. **ุงุถุบุท ุนูู Button** (ุชุฃููุฏ ุฃู ุฅูุบุงุก)

4. **ูุงุฒู ูุฑุฌุนูู ุฑุฏ ููุฑุงู:**
   ```
   โ ุชู ุชุฃููุฏ ุทูุจู ุจูุฌุงุญ!
   
   ุฑูู ุงูุทูุจ: 1005
   
   ุณูุชู ุงูุชูุงุตู ูุนู ูุฑูุจุงู...
   ```

---

## ๐ ูู Token ููุชูู

### ุชุญุฏูุซ Token:

```bash
node diagnose-whatsapp.js
```

ูู ุทูุน:
```
โ Token expired on Friday, 13-Feb-26 06:00:00 PST
```

**ุงูุญู:**

1. Meta Developer Console โ WhatsApp โ API Setup
2. ุงูุณุฎ **Temporary access token**
3. CRM โ Settings โ Profile & WhatsApp
4. ุงุถุบุท **Edit**
5. ุงูุตู Token ุงูุฌุฏูุฏ
6. ุงุถุบุท **Save**

**ุฃู ุงุณุชุฎุฏู Permanent Token** (ุฃูุถู):
- Business Manager โ System Users โ Generate Token
- ุงุฎุชุงุฑ **Never expires**

---

## ๐ ุชุดุฎูุต ุงููุดููุฉ

### ูู ูุณู ูุด ุดุบุงู:

#### 1. ุดูู Vercel Logs:

1. ุงูุชุญ: **https://vercel.com/dashboard**
2. ุงุฎุชุงุฑ ุงููุดุฑูุน **wahtsapp2**
3. ุงุถุบุท **Logs**
4. ุงุจุญุซ ุนู: `button clicked` ุฃู `interactive`

**ูู ูููุด logs:**
โ Webhook ูุด ูุงุตู ููุณูุฑูุฑ
โ ุงุฑุฌุน ููุฎุทูุฉ 1 ูุชุฃูุฏ ูู Meta Configuration

#### 2. ุดูู Meta Webhook Logs:

1. Meta Developer Console
2. WhatsApp โ Configuration โ Webhook
3. ุดูู **Recent deliveries**

**ูู ูููุง โ Failed:**
โ ูู ูุดููุฉ ูู ุงูู URL ุฃู Token

---

## โ๏ธ ุฃุฎุทุงุก ุดุงุฆุนุฉ

### โ ุฎุทุฃ 1: Webhook URL ุบูุท

```
โ https://wahtsapp2.vercel.app/api/shopify/webhook-handler
โ https://wahtsapp2.vercel.app/api/webhook
```

**ููุญูุธุฉ:** ุงูู Shopify webhook ูุฎุชูู ุนู WhatsApp webhook!

### โ ุฎุทุฃ 2: Verify Token ุบูุท

```
โ whatsapp_crm_2025
โ whatsapp_crm_2024
```

ูุงุฒู ูุทุงุจู ุงููู ูู ุงูููุฏ ุจุงูุธุจุท.

### โ ุฎุทุฃ 3: ูุด Subscribe to messages

ูุงุฒู ุชุถุบุท **Subscribe** ุนูู `messages` field.

### โ ุฎุทุฃ 4: Token ููุชูู

ูู Token ููุชููุ ูุด ูููุฏุฑ ูุจุนุช ุฑุฏ ููุนููู.
ุงุณุชุฎุฏู Permanent Token.

---

## ๐ Checklist ุงูููุงุฆู

ูุจู ูุง ุชุฌุฑุจ ุชุงููุ ุชุฃูุฏ ูู:

- [ ] WhatsApp Webhook URL: `https://wahtsapp2.vercel.app/api/webhook`
- [ ] Verify Token: `whatsapp_crm_2024`
- [ ] Subscribe to `messages` โ
- [ ] Webhook Test ูุงุฌุญ โ
- [ ] WhatsApp Token ุตุงูุญ (ูุด ููุชูู)
- [ ] Vercel Deployment: Ready โ

---

## ๐ฏ ุงูู Flow ุงูุตุญูุญ

```
ุงูุนููู ูุถุบุท Button
    โ
WhatsApp ูุจุนุช webhook
    โ
api/webhook.js ูุณุชูุจู
    โ
ูุดูู ููุน ุงูุฑุณุงูุฉ: interactive
    โ
ูุณุชุฎุฑุฌ button_id
    โ
ูุณุชุฏุนู handle-button-click.js
    โ
ูุญุฏุซ Order ูู Database
    โ
ูุญุฏุซ Order ูู Shopify
    โ
ูุจุนุช ุฑุณุงูุฉ ุชุฃููุฏ ููุนููู โ
```

---

## โ ุงูุฎูุงุตุฉ

**3 ุฎุทูุงุช ุจุณ:**

1. โ Meta Console โ Webhook โ ุชุฃูุฏ ูู URL ู Token
2. โ Subscribe to "messages"
3. โ Test ูู WhatsApp

**ุจุนุฏ ูุฏู:**
- ุงูู Buttons ูุชุดุชุบู โ
- ุงูุฑุฏ ููุฑุฌุน ููุนููู โ
- Order status ููุชุญุฏุซ ูู Shopify โ

---

## ๐ ูู ูุณู ูุด ุดุบุงู

ุงุจุนุชูู:
1. Screenshot ูู Meta Webhook Configuration
2. ุขุฎุฑ 5 ุณุทูุฑ ูู Vercel Logs (ููุง ุชุถุบุท Button)
3. ูุชูุฌุฉ: `node test-button-webhook.js`

---

**๐ ุฌุฑุจ ุฏูููุชู!**
