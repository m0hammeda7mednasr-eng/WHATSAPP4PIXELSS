# ๐ง ุฅุตูุงุญ ุงูู Buttons - ุงูุญู ุงูููุงุฆู

## ุงููุดููุฉ

โ ููุง ุงูุนููู ูุถุบุท "ุชุฃููุฏ" ุฃู "ุฅูุบุงุก"ุ ูููุด ุญุงุฌุฉ ุจุชุญุตู
โ ูููุด ุฑุฏ ุจูุฑุฌุน ููุนููู
โ Order status ูุด ุจูุชุญุฏุซ ูู Shopify

---

## ุงูุณุจุจ

**WhatsApp Webhook ูุด ูุชูุตู ุตุญ!**

ููุง ุงูุนููู ูุถุบุท Buttonุ WhatsApp ุจูุจุนุช webhook ููุณูุณุชู.
ูู ุงูู webhook ูุด ูุชูุตูุ ุงูุณูุณุชู ูุด ููุนุฑู ุฅู ุงูุนููู ุถุบุท ุญุงุฌุฉ.

---

## โ ุงูุญู ุงููุงูู (ุฎุทูุฉ ุจุฎุทูุฉ)

### ุงูุฎุทูุฉ 1: ุชุญูู ูู WhatsApp Webhook ูู Meta

1. ุงูุชุญ: https://developers.facebook.com/apps

2. ุงุฎุชุงุฑ App ุจุชุงุนู

3. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ: **WhatsApp** โ **Configuration**

4. ูู ูุณู **Webhook**:

```
Callback URL: https://wahtsapp2.vercel.app/api/webhook
Verify token: whatsapp_crm_2024
```

5. ุงุถุบุท **Verify and save** โ

6. ูู **Webhook fields**ุ ุชุฃูุฏ ุฅู ุฏูู ููุนููู:
   - โ **messages** (ููู ุฌุฏุงู!)
   - โ **message_status** (ุงุฎุชูุงุฑู)

7. ุงุถุบุท **Subscribe** ุนูู ูู ูุงุญุฏ

---

### ุงูุฎุทูุฉ 2: ุงุฎุชุจุฑ ุงูู Webhook

**ูู Meta Developer Console:**

1. ูู ููุณ ุตูุญุฉ Webhook Configuration
2. ุงุถุบุท **Test** ุจุฌุงูุจ ุงูู webhook
3. ุงุฎุชุงุฑ **messages**
4. ุงุถุบุท **Send Test**
5. ูุงุฒู ูุทูุน: โ **Success**

ูู ุทูุน โ **Failed**:
- ุชุญูู ูู Callback URL
- ุชุญูู ูู Verify Token
- ุดูู Vercel Logs

---

### ุงูุฎุทูุฉ 3: ุญุฏุซ WhatsApp Token

**ููู ุฌุฏุงู!** Token ูุงุฒู ูููู ุตุงูุญ:

```bash
node diagnose-whatsapp.js
```

ูู Token ููุชูู:
1. Meta Developer Console โ WhatsApp โ API Setup
2. ุงูุณุฎ Temporary access token
3. CRM โ Settings โ Profile & WhatsApp โ Edit โ Save

**ุฃู ุงุณุชุฎุฏู Permanent Token** (ููุตู ุจู):
- Business Manager โ System Users โ Generate Token
- Never expires

---

### ุงูุฎุทูุฉ 4: ุชุญูู ูู Vercel Deployment

1. ุงูุชุญ: https://vercel.com/dashboard

2. ุงุฎุชุงุฑ ุงููุดุฑูุน `wahtsapp2`

3. ุชุฃูุฏ ุฅู ุขุฎุฑ deployment: **Ready** โ

4. ูู ูู ูุดุงููุ ุงุนูู redeploy:
   ```bash
   git commit --allow-empty -m "Redeploy"
   git push origin main
   ```

---

### ุงูุฎุทูุฉ 5: ุงุฎุชุจุฑ Button Click

**ูู WhatsApp ูุจุงุดุฑุฉ:**

1. ุงุจุนุช ุฑุณุงูุฉ ููุจุฑุงูุฏ ูู ุฑููู
2. ุงูุจุฑุงูุฏ ูุฑุฏ ุนููู ุจุฑุณุงูุฉ ูููุง buttons
3. ุงุถุบุท ุนูู Button
4. ูุงุฒู ูุฑุฌุนูู ุฑุฏ ููุฑุงู โ

**ูู Shopify:**

1. ุงุนูู test order
2. ุงูุฑุณุงูุฉ ุชูุตู ูุน buttons
3. ุงุถุบุท "ุชุฃููุฏ"
4. ูุงุฒู ูุฑุฌุนูู: "ุชู ุชุฃููุฏ ุทูุจู ุจูุฌุงุญ!" โ

---

## ๐ ุชุดุฎูุต ุงููุดููุฉ

### ุงุฎุชุจุงุฑ 1: ูู ุงูู Webhook ุจูุณุชูุจูุ

```bash
node test-webhook-now.js
```

ุดูู ุขุฎุฑ ุฑุณุงุฆู ูู ุงูุฏุงุชุงุจูุฒ.
ูู ูููุด ุฑุณุงุฆู ุฌุฏูุฏุฉ โ Webhook ูุด ุดุบุงู

### ุงุฎุชุจุงุฑ 2: ุดูู Vercel Logs

1. Vercel Dashboard โ Logs
2. ุงุจุญุซ ุนู: `button clicked` ุฃู `interactive`
3. ูู ูููุด logs โ Webhook ูุด ูุงุตู

### ุงุฎุชุจุงุฑ 3: ุดูู Meta Webhook Logs

1. Meta Developer Console
2. WhatsApp โ Configuration โ Webhook
3. ุดูู **Recent deliveries**
4. ูู ูููุง โ Failed โ ูู ูุดููุฉ ูู ุงูู URL

---

## โ๏ธ ุงูุฃุฎุทุงุก ุงูุดุงุฆุนุฉ

### ุฎุทุฃ 1: Webhook URL ุบูุท

```
โ https://wahtsapp2.vercel.app/api/shopify/webhook-handler
โ https://wahtsapp2.vercel.app/api/webhook
```

ุงูู Shopify webhook ูุฎุชูู ุนู WhatsApp webhook!

### ุฎุทุฃ 2: Verify Token ุบูุท

```
โ whatsapp_crm_2025
โ whatsapp_crm_2024
```

ูุงุฒู ูุทุงุจู ุงููู ูู ุงูููุฏ ุจุงูุธุจุท.

### ุฎุทุฃ 3: ูุด Subscribe to messages

ูุงุฒู ุชุถุบุท **Subscribe** ุนูู `messages` field.

### ุฎุทุฃ 4: Token ููุชูู

ูู Token ููุชููุ ูุด ูููุฏุฑ ูุจุนุช ุฑุฏ ููุนููู.

---

## ๐ Checklist

ูุจู ูุง ุชุฌุฑุจ ุชุงููุ ุชุฃูุฏ ูู:

- [ ] WhatsApp Webhook URL ุตุญูุญ
- [ ] Verify Token ุตุญูุญ
- [ ] Subscribe to `messages` โ
- [ ] Webhook Test ูุงุฌุญ โ
- [ ] WhatsApp Token ุตุงูุญ
- [ ] Vercel Deployment Ready
- [ ] Shopify Webhook ูุถุงู (ููู orders)

---

## ๐ฏ ุงูู Flow ุงูุตุญูุญ

```
1. ุงูุนููู ูุถุบุท Button ุนูู WhatsApp
   โ
2. WhatsApp ูุจุนุช POST request ูู:
   https://wahtsapp2.vercel.app/api/webhook
   โ
3. api/webhook.js ูุณุชูุจู ุงูู request
   โ
4. ูุดูู ุฅู ุงูุฑุณุงูุฉ ููุนูุง "interactive"
   โ
5. ูุณุชุฎุฑุฌ button_id (ูุซูุงู: confirm_123)
   โ
6. ูุณุชุฏุนู api/shopify/handle-button-click.js
   โ
7. handle-button-click ูุนูู:
   - ูุฌูุจ Order ูู database
   - ูุญุฏุซ Order status
   - ูุจุนุช ุฑุณุงูุฉ ุชุฃููุฏ ููุนููู
   - ูุญุฏุซ Shopify
   โ
8. ุงูุนููู ูุณุชูู ุฑุณุงูุฉ: "ุชู ุชุฃููุฏ ุทูุจู!" โ
```

---

## ๐ง ุงูุญู ุงูุณุฑูุน

ูู ุนุงูุฒ ุชุฎุชุจุฑ ุจุณุฑุนุฉ:

### 1. ุชุฃูุฏ ูู Webhook

```bash
curl -X GET "https://wahtsapp2.vercel.app/api/webhook?hub.mode=subscribe&hub.verify_token=whatsapp_crm_2024&hub.challenge=test123"
```

ูุงุฒู ูุฑุฌุน: `test123`

### 2. ุงุจุนุช Test Message

ูู ุงูู CRM:
1. ุงุฎุชุงุฑ Contact
2. ุงุจุนุช ุฑุณุงูุฉ
3. ูู ูุตูุช โ Token ุดุบุงู โ

### 3. ุงุนูู Test Button Click

ูู WhatsApp:
1. ุงุจุนุช ุฑุณุงูุฉ ููุจุฑุงูุฏ
2. ุงูุจุฑุงูุฏ ูุฑุฏ ุจุฑุณุงูุฉ ูููุง buttons
3. ุงุถุบุท Button
4. ูู ุฑุฌุนูู ุฑุฏ โ Webhook ุดุบุงู โ

---

## ๐ฑ ูุซุงู ุนูู ุงูุฑุณุงูุฉ ุงูุตุญูุญุฉ

**ุงูุฑุณุงูุฉ ุงููู ุจุชุชุจุนุช:**
```
๐งพ ุฑูู ุงูุทูุจ: #1005
๐งฃ ุงููุทุน: Teddy Sofa...
๐ฐ ุงููุฌููุน: 19500 EGP
...

[ุชุฃููุฏ] [ุฅูุบุงุก]  โ Buttons
```

**ููุง ุงูุนููู ูุถุบุท "ุชุฃููุฏ":**
```
โ ุชู ุชุฃููุฏ ุทูุจู ุจูุฌุงุญ!

ุฑูู ุงูุทูุจ: 1005

ุณูุชู ุงูุชูุงุตู ูุนู ูุฑูุจุงู...
```

---

## โ ุงูุฎูุงุตุฉ

**ุงููุดููุฉ ุงูุฑุฆูุณูุฉ:**
- WhatsApp Webhook ูุด ูุชูุตู ุฃู ูุด ุดุบุงู

**ุงูุญู:**
1. โ ุชุฃูุฏ ูู Webhook URL ูู Meta
2. โ Subscribe to `messages`
3. โ Test ุงูู webhook
4. โ ุญุฏุซ Token
5. โ ุงุนูู test order ุฌุฏูุฏ

**ุจุนุฏ ูุฏู:**
- ุงูู buttons ูุชุดุชุบู โ
- ุงูุฑุฏ ููุฑุฌุน ููุนููู โ
- Order status ููุชุญุฏุซ ูู Shopify โ

---

**๐ ุฌุฑุจ ุฏูููุชู!**

ูู ูุณู ูุด ุดุบุงูุ ุงุจุนุชูู:
1. Screenshot ูู Meta Webhook Configuration
2. ุขุฎุฑ 5 ุณุทูุฑ ูู Vercel Logs
3. ุขุฎุฑ ุฑุณุงูุฉ ูู ุงูุฏุงุชุงุจูุฒ
